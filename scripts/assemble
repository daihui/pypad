#!/usr/bin/env python

"""
A simple script that takes a CSPad specification and a raw image and renders
an assembled image.
"""

import tables
import argparse

from pypad import cspad
from pypad import utils

import matplotlib.pyplot as plt
from pypad.plot import InteractiveImshow

parser = argparse.ArgumentParser(description='''Use a CSPAD geometry to assemble a raw image.''')
                                 
parser.add_argument('image_file', help='The (raw) image file.')
parser.add_argument('--param-dir', default=None, 
                    help='''The CSPAD alignment parameters to use for the assembly, should be
                            a directory (default: pyana default metrology)''')
                            
args = parser.parse_args()

raw_image = utils.load_raw_image(args.image_file)

if args.param_dir:
    cs1 = cspad.CSPad.from_dir(args.param_dir)
else:
    cs1 = cspad.CSPad.default()

plt.figure()
plt.imshow( cs1(raw_image).T, origin='lower', vmin=0, vmax=50, interpolation='nearest' )
plt.show()
